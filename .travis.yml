sudo: required

language: scala

scala:
  - 2.11.8

jdk:
  - oraclejdk8

env:
  global:
    - AWS_ACCESS_KEY_ID=foo
    - AWS_SECRET_ACCESS_KEY=bar

cache:
  - bundler
  
services:
  - docker

install:
  - bundle install
  - docker run -it -v "$PWD":/tmp -w /tmp composer/composer:1-alpine install

script:
  - sbt clean coverage test
  - sbt run > log.txt &
  - bash <(curl -s https://raw.githubusercontent.com/s12v/wait4port/master/wait4port.sh) localhost:9911
  - ENDPOINT=http://localhost:9911/ bundle exec cucumber
  - >
    docker run -it
    -e AWS_ACCESS_KEY_ID="$AWS_ACCESS_KEY_ID"
    -e AWS_SECRET_ACCESS_KEY="$AWS_SECRET_ACCESS_KEY"
    -e ENDPOINT="http://localhost:9911"
    -v "$PWD":/tmp -w /tmp --net=host php:7-alpine
    bin/behat

after_failure:
  - cat log.txt

after_success:
  - bash <(curl -s https://codecov.io/bash)
