sudo: required

language: scala

scala:
  - 2.11.8

jdk:
  - oraclejdk8

env:
  matrix:
    - SDK=none
    - SDK=ruby
    - SDK=php

cache:
  - bundler
  
services:
  - docker

install:
  - bundle install
  - wget https://getcomposer.org/download/1.1.1/composer.phar
  - docker run -it -v "$PWD":/tmp -w /tmp php:7-apline php composer.phar install

script:
  - sbt clean coverage test
  - sbt run > log.txt &
  - bash <(curl -s https://raw.githubusercontent.com/s12v/wait4port/master/wait4port.sh) localhost:9911
#  - AWS_ACCESS_KEY_ID=foo AWS_SECRET_ACCESS_KEY=bar ENDPOINT=http://localhost:9911/ bundle exec cucumber
  - >
    docker run -it --rm -e "ENDPOINT=http://localhost:9911" -v "$PWD":/tmp -w /tmp --net=host && 
    php:7-cli bin/behat

after_failure:
  - cat log.txt

after_success:
  - bash <(curl -s https://codecov.io/bash)
