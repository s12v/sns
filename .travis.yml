sudo: required

language: scala

scala:
  - 2.11.8

jdk:
  - oraclejdk8

env:
  matrix:
    - SDK=none
    - SDK=ruby
    - SDK=php

cache:
  - bundler
  
service:
  - docker

install:
  - if [ "$SDK" = "ruby" ]; then bundle install; fi
  - if [ "$SDK" = "php" ]; then wget https://getcomposer.org/download/1.1.1/composer.phar; fi
  - if [ "$SDK" = "php" ]; then docker run -it -v "$PWD":/tmp -w /tmp php:7-cli php composer.phar install; fi

before_script:
  - if [ "$SDK" != "none" ]; then sbt compile && sbt run > log.txt & fi
  - if [ "$SDK" != "none" ]; then bash <(curl -s https://raw.githubusercontent.com/s12v/wait4port/master/wait4port.sh) localhost:9911; fi

script:
  - if [ "$SDK" = "none" ]; then sbt clean coverage test; fi
  - if [ "$SDK" = "ruby" ]; then AWS_ACCESS_KEY_ID=foo AWS_SECRET_ACCESS_KEY=bar ENDPOINT=http://localhost:9911/ bundle exec cucumber; fi
  - if [ "$SDK" = "php" ]; then docker run -it --rm -e "ENDPOINT=http://localhost:9911" -v "$PWD":/tmp -w /tmp --net=host php:7-cli bin/behat; fi

after_failure:
  - if [ "$SDK" != "none" ]; then cat log.txt; fi

after_success:
  - if [ "$SDK" = "none" ]; then bash <(curl -s https://codecov.io/bash); fi
